(function(a){a.expr[":"].linkingToImage=function(b,c,d){return !!(a(b).attr(d[3])&&a(b).attr(d[3]).match(/\.(gif|jpe?g|png|bmp)$/i))};a.fn.imgPreview=function(e){var c=a.extend({imgCSS:{},distanceFromCursor:{top:10,left:10},preloadImages:true,onShow:function(){},onHide:function(){},onLoad:function(){},containerID:"imgPreviewContainer",containerLoadingClass:"loading",thumbPrefix:"",srcAttr:"href"},e),m=a("<div/>").attr("id",c.containerID).append("<img/>").hide().css("position","absolute").appendTo("body"),l=a("img",m).css(c.imgCSS),k=this.filter(":linkingToImage("+c.srcAttr+")");function g(b){return b.replace(/(\/?)([^\/]+)$/,"$1"+c.thumbPrefix+"$2")}if(c.preloadImages){(function(b){var d=new Image(),f=arguments.callee;d.src=g(a(k[b]).attr(c.srcAttr));d.onload=function(){k[b+1]&&f(b+1)}})(0)}k.mousemove(function(b){m.css({top:b.pageY+c.distanceFromCursor.top+"px",left:b.pageX+c.distanceFromCursor.left+"px"})}).hover(function(){var b=this;m.addClass(c.containerLoadingClass).show();l.load(function(){m.removeClass(c.containerLoadingClass);l.show();c.onLoad.call(l[0],b)}).attr("src",g(a(b).attr(c.srcAttr)));c.onShow.call(m[0],b)},function(){m.hide();l.unbind("load").attr("src","").hide();c.onHide.call(m[0],this)});return this}})(jQuery);